# face_detect.py
import cv2

# Path to the built-in haar cascade in your OpenCV installation.
# If this fails, download 'haarcascade_frontalface_default.xml' and put it next to this script.
cascade_path = cv2.data.haarcascades + "haarcascade_frontalface_default.xml"

def detect_faces(image_path, show=True, save_out=None):
    img = cv2.imread(image_path)
    if img is None:
        raise FileNotFoundError(f"Cannot open image: {image_path}")

    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    face_cascade = cv2.CascadeClassifier(cascade_path)

    faces = face_cascade.detectMultiScale(gray, scaleFactor=1.1, minNeighbors=5, minSize=(30, 30))

    for (x, y, w, h) in faces:
        cv2.rectangle(img, (x, y), (x+w, y+h), (0, 255, 0), 2)
        cv2.putText(img, "face", (x, y-10), cv2.FONT_HERSHEY_SIMPLEX, 0.6, (0,255,0), 2)

    print(f"Detected {len(faces)} faces.")

    if show:
        cv2.imshow("Faces", img)
        cv2.waitKey(0)
        cv2.destroyAllWindows()

    if save_out:
        cv2.imwrite(save_out, img)
        print(f"Saved result to {save_out}")

    return faces

if __name__ == "__main__":
    import sys
    if len(sys.argv) < 2:
        print("Usage: python face_detect.py <image_path> [output_path]")
        sys.exit(1)
    img_path = sys.argv[1]
    out = sys.argv[2] if len(sys.argv) > 2 else None
    detect_faces(img_path, show=True, save_out=out)
